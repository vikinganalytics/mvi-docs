

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Manager Configuration &mdash; Multiviz Integrator  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Testing Services Before Deployment" href="testing_services.html" />
    <link rel="prev" title="Autocompletion" href="cli_autocompletion.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/VA_Symbol_DarkBlue.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/mvi_description.html">MultiViz Integrator</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/first_service.html">Deploying Your First Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/custom_service.html">Creating Your Own service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/dashboard.html">Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/autodocs.html">API Autodocs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/shadow_deployment.html">Versioning and Shadow Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/reaching_service_from_external_applications.html">Reaching a service from external applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/ticker.html">Schedule Repeating Actions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/monitoring.html">Monitoring Your Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/cross_service_communication.html">Cross-service Communication</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="deploying_ml_model.html">Deploying Machine Learning Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="sdk_typing.html">Typing in the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_multiple_hosts.html">Using Multiple Hosts</a></li>
<li class="toctree-l1"><a class="reference internal" href="email_notifications.html">Email Notifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager_api.html">Manager API</a></li>
<li class="toctree-l1"><a class="reference internal" href="adv_deploy.html">Deployment Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli_autocompletion.html">Autocompletion</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Manager Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#secure-manager-connection">Secure Manager Connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="#email-notifications">Email notifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#log-configuration">Log configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#typical-production-setup">Typical production setup</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing_services.html">Testing Services Before Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="proxy_dashboard.html">Proxy Dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="integration_with_other_tools.html">Connecting MVI with Other Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="going_beyond_sdk.html">Going Beyond the SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="upload_image.html">Upload local docker image</a></li>
</ul>
<p class="caption"><span class="caption-text">Special Usecases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/ui_streamlit.html">Using Streamlit to build a dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/ui_plotly_dash.html">Using Plotly Dash to build a dashboard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/conda.html">Using MVI with Conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../special_usecases/gpu_services.html">Access NVIDIA GPUs</a></li>
</ul>
<p class="caption"><span class="caption-text">Api Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/cli.html">Command-line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/sdk.html">Software Development Kit</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Multiviz Integrator</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Manager Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/content/advanced_tutorials/manager_configuration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="manager-configuration">
<span id="manager-configuration-reference"></span><h1>Manager Configuration<a class="headerlink" href="#manager-configuration" title="Permalink to this headline">¶</a></h1>
<p>The Manager is highly configurable using environment variables.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 19%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Environment Variable</p></th>
<th class="head"><p>Default Value</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MVI_HOST_NAME</p></td>
<td><p>“localhost”</p></td>
<td><p>Host name of the machine running the Manager.</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_PROXY_HTTP_PORT</p></td>
<td><p>80</p></td>
<td><p>Proxy port for HTTP communication with Manager.</p></td>
</tr>
<tr class="row-even"><td><p>MVI_PROXY_HTTPS_PORT</p></td>
<td><p>443</p></td>
<td><p>Proxy port for HTTP communication with Manager.</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_PROXY_CONFIG_PATH</p></td>
<td><p>“proxy_config”</p></td>
<td><p>Path to proxy configuration files.</p></td>
</tr>
<tr class="row-even"><td><p>MVI_AUTH_ENABLED</p></td>
<td><p>False</p></td>
<td><p>Using the Manager requires login if true.</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_MAX_REQUEST_BODY</p></td>
<td><p>1000000000</p></td>
<td><p>Maximum allowed transferred filesize. 1GB default.</p></td>
</tr>
<tr class="row-even"><td><p>MVI_LOG_LEVEL</p></td>
<td><p>“INFO”</p></td>
<td><p>Minimum logger level for Manager.</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_ACCESS_LOGS_ENABLED</p></td>
<td><p>True</p></td>
<td><p>Whether to print access logs.</p></td>
</tr>
<tr class="row-even"><td><p>MVI_PROXY_HTTPS</p></td>
<td><p>False</p></td>
<td><p>Sets up a secure connection to the Manager if true</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_HTTPS_STAGING_SERVER</p></td>
<td><p>False</p></td>
<td><p>Sets if a staging server without rate limits should be used</p></td>
</tr>
<tr class="row-even"><td><p>MVI_CONFIG_EMAIL</p></td>
<td><p>null</p></td>
<td><p>Email address HTTPS and sending notifications.</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_CONFIG_EMAIL_PASSWORD</p></td>
<td><p>null</p></td>
<td><p>Password for config email, only required for notifications.</p></td>
</tr>
<tr class="row-even"><td><p>MVI_NOTIFICATION_SMTP_SERVER</p></td>
<td><p>null</p></td>
<td><p>SMTP server URL.</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_NOTIFICATION_SMTP_PORT</p></td>
<td><p>null</p></td>
<td><p>Port to SMTP server, usually 587 or 465.</p></td>
</tr>
<tr class="row-even"><td><p>MVI_ACTIVATION_KEY</p></td>
<td><p>“”</p></td>
<td><p>License activation key. Without key Manager lives for 12h.</p></td>
</tr>
</tbody>
</table>
<div class="section" id="secure-manager-connection">
<h2>Secure Manager Connection<a class="headerlink" href="#secure-manager-connection" title="Permalink to this headline">¶</a></h2>
<p>It is possible to get a secure HTTPS connection to the Manager using automatically
created certificates from <a class="reference external" href="https://letsencrypt.org">Let’s Encrypt</a>. To enable HTTPS you must
start a new Manager with the environment variable
<code class="docutils literal notranslate"><span class="pre">MVI_PROXY_HTTPS</span></code> set to true. We also recommend that you set an email
address with the environment variable <code class="docutils literal notranslate"><span class="pre">MVI_CONFIG_EMAIL</span></code>, so you can get
notified if the certificate is about to run out.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For the <cite>Let’s Encrypt</cite> certificates to work,
the server must have a valid hostname which resolves via DNS to the server’s IP
address. It will not work if you access the Manager using an IP address or
<code class="docutils literal notranslate"><span class="pre">localhost</span></code> due to how TLS certificates are generated.</p>
</div>
</div>
<div class="section" id="email-notifications">
<h2>Email notifications<a class="headerlink" href="#email-notifications" title="Permalink to this headline">¶</a></h2>
<p>The first step is to set up an email address that the MVI Manager can use to send
the notification emails. For this you need an
<a class="reference external" href="https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol">SMTP</a> server with
an email account that you can use. We recommend to have a dedicated email address
for sending MVI notifications.</p>
<p>The Manager is configured with a notification sender email at startup. We do this
by setting four different environment variables at Manager startup</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 63%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Environment Variable</p></th>
<th class="head"><p>Value</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>MVI_CONFIG_EMAIL</p></td>
<td><p>“<a class="reference external" href="mailto:email&#37;&#52;&#48;address&#46;com">email<span>&#64;</span>address<span>&#46;</span>com</a>”</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_CONFIG_EMAIL_PASSWORD</p></td>
<td><p>“password”</p></td>
</tr>
<tr class="row-even"><td><p>MVI_NOTIFICATION_SMTP_SERVER</p></td>
<td><p>“smtp.server.url”</p></td>
</tr>
<tr class="row-odd"><td><p>MVI_NOTIFICATION_SMTP_PORT</p></td>
<td><p>Usually 587 or 465</p></td>
</tr>
</tbody>
</table>
<p>Upon startup of the Manager, if everything worked, an email will be sent from
“<a class="reference external" href="mailto:email&#37;&#52;&#48;address&#46;com">email<span>&#64;</span>address<span>&#46;</span>com</a>” to itself, to show that it successfully connected. Otherwise,
as long as the Manager could still start, any issues with the email configuration
will be viewable on the notification tab in the dashboard.</p>
</div>
<div class="section" id="log-configuration">
<h2>Log configuration<a class="headerlink" href="#log-configuration" title="Permalink to this headline">¶</a></h2>
<p>All logging in MVI is done directly to stdout and stderr and relies heavily on the
built-in logging features of the docker daemon. As such, any configuration of log
rotation etc needs to be done on the docker daemon level.</p>
<p>MVI takes care of setting reasonable log configuration options on all the
<em>services</em> that are started. For each service, this means that log files are rotated when
they grow above 100MB in size and a maximum of 3 such files are kept on disk.</p>
<p>For the Manager container however, the log configuration is left to the user. But we give
some hints here on reasonable options. In general, the docker daemon and its logging
mechanism can be configured in two ways, either by editing the <code class="docutils literal notranslate"><span class="pre">daemon.json</span></code> configuration
file (which sets daemon-wide default configurations) or by providing container-specific
configuration when starting a new container with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>. For more details, please
have a look at the <a class="reference external" href="https://docs.docker.com/config/containers/logging/configure/">docker docs</a>.</p>
<p>An example container-specific configuration could be provided as such (maximum of 5 log
files no larger than 10 megabytes each using the JSON log handler (the docker daemon default)):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">...</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">driver</span> <span class="n">json</span><span class="o">-</span><span class="n">file</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">opt</span> <span class="nb">max</span><span class="o">-</span><span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="n">m</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">opt</span> <span class="nb">max</span><span class="o">-</span><span class="n">file</span><span class="o">=</span><span class="mi">5</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>By default, the docker daemon is configured to <em>NOT</em> do any log rotation at all,
meaning that it will slowly fill up the HDD of the host. To avoid any problems
originating from a full HDD, we highly recommend setting a specific log configuration
for the Manager container when starting.</p>
</div>
</div>
<div class="section" id="typical-production-setup">
<h2>Typical production setup<a class="headerlink" href="#typical-production-setup" title="Permalink to this headline">¶</a></h2>
<p>The example below starts a Manager instance that is listening on <code class="docutils literal notranslate"><span class="pre">my.domain.com</span></code>, enforcing traffic over https with access
control enabled and being activated using a provided activation key:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker run
    --name mvi_manager
    -v /var/run/docker.sock:/var/run/docker.sock
    -v mvi_data:/data
    -p <span class="m">80</span>:80
    -p <span class="m">443</span>:443
    -e <span class="nv">MVI_HOST_NAME</span><span class="o">=</span>my.domain.com
    -e <span class="nv">MVI_PROXY_HTTPS</span><span class="o">=</span>True
    -e <span class="nv">MVI_AUTH_ENABLED</span><span class="o">=</span>True
    -e <span class="nv">MVI_ACTIVATION_KEY</span><span class="o">=</span>...
    -e <span class="nv">MVI_CONFIG_EMAIL</span><span class="o">=</span>&lt;some@email.com&gt;
    -e <span class="nv">MVI_CONFIG_EMAIL_PASSWORD</span><span class="o">=</span>&lt;password <span class="k">for</span> some@email.com&gt;
    -e <span class="nv">MVI_NOTIFICATION_SMTP_SERVER</span><span class="o">=</span>&lt;your smtp server address&gt;
    -e <span class="nv">MVI_NOTIFICATION_SMTP_PORT</span><span class="o">=</span>&lt;your smtp server port&gt;
    --restart always
    --log-driver json-file
    --log-opt max-size<span class="o">=</span>100m
    --log-opt max-file<span class="o">=</span><span class="m">5</span>
    -d ghcr.io/vikinganalytics/mvi/mvi_manager:<span class="o">{</span>version<span class="o">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To ease working with all environment variables, it is possible to make use
of the <code class="docutils literal notranslate"><span class="pre">--env-file</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>.
See <a class="reference external" href="https://docs.docker.com/engine/reference/commandline/run/#set-environment-variables--e---env---env-file">here</a>
for details on syntax etc.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="testing_services.html" class="btn btn-neutral float-right" title="Testing Services Before Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="cli_autocompletion.html" class="btn btn-neutral float-left" title="Autocompletion" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Viking Analytics AB.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>